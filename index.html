<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>140 W 11th — Housekeeping Task Tracker 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Optional tiny icon in the heading -->
  <link rel="icon" href="assets/site-icon.png" />
  <style>
    :root{
      --bg1:#5D6BE0; --bg2:#5F2B83;
      --panel:#28343E; --panelText:#fff;
      --chip: #e9eef3; --chipText:#111;
      --primary:#1E90FF; --muted:#e9eef3;
      --danger:#d33; --ok:#31a24c;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% -10%, var(--bg1), transparent 60%),
                  radial-gradient(1200px 800px at 80% -10%, var(--bg2), transparent 60%),
                  #1c2240;
      min-height:100vh; color:#0d1b2a;
    }
    .wrap{
      max-width:920px; margin:28px auto; padding:0 16px;
    }
    .card{
      background:#fff; border-radius:14px; box-shadow:0 10px 35px rgba(0,0,0,.15);
      overflow:hidden;
    }
    .nav{
      background:#2e3a44; color:#fff; padding:22px 24px; text-align:center;
    }
    .title{display:flex; align-items:center; gap:12px; justify-content:center}
    .title img{width:32px; height:32px; object-fit:contain}
    .title h1{margin:0; font-size:40px; letter-spacing:.5px}
    .subtitle{opacity:.85; margin-top:4px; font-size:14px}
    .tabs{display:flex; gap:8px; justify-content:center; margin:16px auto 0}
    .tab-btn{
      padding:8px 14px; border-radius:8px; border:1px solid rgba(255,255,255,.15);
      background:#3a4955; color:#fff; cursor:pointer; font-weight:600;
    }
    .tab-btn.active{background:#4c6374}
    .body{padding:20px}
    .row{display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin:8px 0 14px}
    label{font-size:12px; font-weight:700; color:#374151; display:block; margin-bottom:6px}
    select, input[type="date"]{
      width:100%; padding:10px 12px; border-radius:8px; border:1px solid #d0d7de; background:#fff;
      font-size:14px;
    }
    .chips{display:flex; flex-wrap:wrap; gap:14px; justify-content:center; padding:14px; background:#eef5fb; border-radius:10px; margin-bottom:14px}
    .chip{display:flex; align-items:center; gap:8px; font-weight:700}
    .dot{width:14px; height:14px; border-radius:50%; border:2px solid #2a2a2a}
    .tasks{
      background:#f7fbff; border:1px solid #dfe7ef; border-radius:12px; padding:16px;
    }
    .task{
      display:flex; align-items:flex-start; gap:10px; padding:10px 12px;
      border:1px solid #e6edf3; border-radius:10px; margin:8px 0; background:#fff;
    }
    .task input{margin-top:3px; transform: scale(1.1)}
    .actions{display:flex; gap:10px; margin-top:12px}
    button{
      border:0; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700
    }
    .btn-primary{background:var(--primary); color:#fff}
    .btn-ghost{background:#eef2f7; color:#111}
    .note{color:#6b7280; font-size:13px; margin-top:6px}
    .hidden{display:none !important}

    /* Manager table */
    table{width:100%; border-collapse:collapse; margin-top:12px}
    th,td{border-bottom:1px solid #e5e7eb; font-size:14px; padding:10px; text-align:left; vertical-align:top}
    th{background:#f3f6fa; font-size:12px; text-transform:uppercase; letter-spacing:.05em}
    .small{font-size:12px; color:#6b7280}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="nav">
        <div class="title">
          <img src="assets/site-icon.png" alt="">
          <h1>140 W 11th</h1>
        </div>
        <div class="subtitle">CHESTERMAN GROUP CORP — Housekeeping Task Tracker 2025</div>
        <div class="tabs">
          <button id="tab-form" class="tab-btn active">Housekeeper Form</button>
          <button id="tab-dash" class="tab-btn">Manager Dashboard</button>
        </div>
      </div>

      <!-- FORM TAB -->
      <div id="formTab" class="body">
        <div class="chips" id="legend"></div>

        <div class="row">
          <div>
            <label>Housekeeper</label>
            <select id="housekeeper"></select>
          </div>
          <div>
            <label>Shift</label>
            <select id="shift"></select>
          </div>
          <div>
            <label>Date</label>
            <input type="date" id="date">
          </div>
        </div>

        <div id="tasksWrap" class="tasks"></div>

        <div class="actions">
          <button id="submitBtn" class="btn-primary">Submit Daily Tasks</button>
          <button id="clearBtn" class="btn-ghost">Clear checks</button>
        </div>
        <div class="note">Unchecked items will be logged to <b>Incomplete Tasks</b> in the sheet.</div>
      </div>

      <!-- MANAGER PANEL -->
<section id="panelMgr" style="display:none">
  <div class="muted">Reading from your Google Sheet via the Netlify Function (GET)</div>
  <table>
    <thead>
      <tr>
        <th>DATE</th><th>HOUSEKEEPER</th><th>SHIFT</th>
        <th>COMPLETED</th><th>TOTAL</th><th>RATE</th>
        <th>SUBMITTED</th><th>INCOMPLETE TASKS</th>
      </tr>
    </thead>
    <tbody id="mgrRows"><tr><td colspan="8">No rows</td></tr></tbody>
  </table>
</section>


    </div>
  </div>

  <script>
    // ---------------- Config ----------------
    const HOUSEKEEPERS = [
      {name:"JACKY",  color:"#e84b3c"},
      {name:"KUNGA",  color:"#2ecc71"},
      {name:"LORENA", color:"#4aa3d9"},
      {name:"HEIDI",  color:"#9b59b6"},
      {name:"ANA",    color:"#f1a20b"},
      {name:"IRMA",   color:"#e91e63"},
      {name:"AGNES",  color:"#34495e"},
      {name:"ANITA",  color:"#2ecc71"},
      {name:"MARIA",  color:"#ECF0F1"} // very light gray
    ];

    const SHIFT_TASKS = {
      "Morning": [
        "Turn lights on (or off exteriors)",
        "Check Mrs. Office; fresh water in Owala stainless steel bottle",
        "Set the table for kids’ breakfast",
        "Empty dishwashers",
        "Walk the dogs then feed",
        "Check dining room from night prior",
        "Do a quick quiet walk through the house to clean anything from the day before",
        "Flowers → Add water or change (task for 2 people)",
        "Assist with family breakfast and any additional needs",
        "Clean up after breakfast",
        "Receive and display packages",
        "Check bathroom on kitchen floor",
        "Clean Oli's room/bathroom",
        "Clean Frankie's room/bathroom",
        "Clean Sonnet's room → if available, if not falls on evening shift",
        "Collect laundry → bring to laundry room",
        "Clean Master if available, if not falls to middle shift",
        "Clean kids’ lounge/snug room",
        "Clean kids’ 3rd floor hallways",
        "Clean kids’ room; organize closets",
        "Clean, organize Caddy and make sure all cleaning tools are put back in right places and handheld vacuum filter is clean and in place."
      ],
      "Middle": [
        "Set up kitchen for kids lunch (clean after)",
        "Assist with cleaning Master or any rooms need attention",
        "Assist with any packages or deliveries",
        "Clean Master level hallway",
        "Clean Sauna room/4th floor",
        "Clean playroom if available",
        "Clean 4th floor hallway",
        "Clean 4th floor powder room → check all of them",
        "Clean gym room; disinfect, organize",
        "Assist with family lunch",
        "Clean Mr. Stewart’s office",
        "Collect kitchen garbage",
        "Sweep outside every morning",
        "Clean garden; blow leaves",
        "Clean and organize furniture by the garden; cover it all if raining",
        "Walk the dogs (Saturday or Sunday)",
        "Clean bathroom on kitchen floor",
        "Help put away laundry when ready",
        "Change water for dogs",
        "Clean, organize Caddy and make sure all cleaning tools are put back in right places and handheld vacuum filter is clean and in place."
      ],
      "Evening": [
        "Ensure lights are on their evening setting around 5:30/6pm",
        "Clean parlor level hallway",
        "Clean dining room",
        "Clean living room",
        "Clean pantry and stairways on parlor level",
        "Clean 138 entryway",
        "Clean parlor level powder room",
        "Clean balcony if needed",
        "Turn down the kids’ rooms after nap (usually after 4pm)",
        "Turn down, clean & refresh all bathrooms",
        "Set dinner table for kids",
        "Assist with family dinner",
        "Clean guest room on kitchen floor",
        "Feed cat and dogs",
        "Walk dogs",
        "Collect garbage (collect g. on sheet for sign days)",
        "Bring clean laundry to the rooms",
        "Check laundry room to ensure nothing is left",
        "Refill fridge and ensure drinks are fully stocked",
        "Empty cat/dog kitchen soup tray",
        "Clean kitchen, pantry and mudroom for the day",
        "Clear family room & check guest room apartment",
        "Dispose of all garbage (Tue: trash/large items; Thu: trash/recycle/compost; Sat: trash/large items)",
        "Clean, organize Caddy and make sure all cleaning tools are put back in right places and handheld vacuum filter is clean and in place."
      ]
    };

    // ---------- UI Build ----------
    const legend = document.getElementById("legend");
    legend.innerHTML = HOUSEKEEPERS.map(h => (
      `<div class="chip"><span class="dot" style="background:${h.color}"></span>${h.name}</div>`
    )).join("");

    const hkSel = document.getElementById("housekeeper");
    hkSel.innerHTML = `<option value="">Select Housekeeper</option>` +
      HOUSEKEEPERS.map(h => `<option>${h.name}</option>`).join("");

    const shiftSel = document.getElementById("shift");
    shiftSel.innerHTML = ["Morning","Middle","Evening"].map(s => `<option>${s}</option>`).join("");

    const dateEl = document.getElementById("date");
    dateEl.value = new Date().toISOString().slice(0,10);

    const tasksWrap = document.getElementById("tasksWrap");
    function renderTasks() {
      const s = shiftSel.value;
      tasksWrap.innerHTML = SHIFT_TASKS[s].map((t,i) => `
        <label class="task">
          <input type="checkbox" data-task="${t.replace(/"/g,'&quot;')}" />
          <span>${t}</span>
        </label>`).join("");
    }
    shiftSel.addEventListener("change", renderTasks);
    renderTasks();

    document.getElementById("clearBtn").onclick = () => {
      tasksWrap.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    };

    // Tabs
    const formTab = document.getElementById("formTab");
    const dashTab = document.getElementById("dashTab");
    const tabForm = document.getElementById("tab-form");
    const tabDash = document.getElementById("tab-dash");

    tabForm.onclick = () => {
      tabForm.classList.add("active"); tabDash.classList.remove("active");
      formTab.classList.remove("hidden"); dashTab.classList.add("hidden");
    };
    tabDash.onclick = async () => {
      tabDash.classList.add("active"); tabForm.classList.remove("active");
      formTab.classList.add("hidden"); dashTab.classList.remove("hidden");
      await loadDashboard();
    };

    // Submit
    const fnURL = "/.netlify/functions/submissions";
    document.getElementById("submitBtn").onclick = async () => {
      const housekeeper = hkSel.value || "";
      const shift = shiftSel.value;
      const date = dateEl.value;
      const all = Array.from(tasksWrap.querySelectorAll('input[type="checkbox"]'));
      const completed = all.filter(cb => cb.checked).map(cb => cb.dataset.task);
      const incomplete = all.filter(cb => !cb.checked).map(cb => cb.dataset.task);
      const completedCount = completed.length;
      const totalTasks = all.length;
      const completionRate = totalTasks ? completedCount / totalTasks : 0;

      if (!housekeeper) { alert("Please select a housekeeper."); return; }

      const payload = {
        date,
        housekeeper,
        shift,
        completedCount,
        totalTasks,
        completionRate,
        submittedAt: new Date().toISOString(),
        incomplete
      };

      try {
        const res = await fetch(fnURL, {
          method:"POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Save error");
        alert("Saved!");
      } catch (e) {
        alert("Could not save: " + e.message);
      }
    };

    // Dashboard
    async function loadDashboard(){
      const tbody = document.querySelector("#dashTable tbody");
      tbody.innerHTML = `<tr><td colspan="8">Loading…</td></tr>`;
      try{
        const res = await fetch(fnURL);
        const data = await res.json();
        const rows = data.rows || [];
        if (!rows.length) { tbody.innerHTML = `<tr><td colspan="8">No rows</td></tr>`; return; }
        tbody.innerHTML = rows.map(r => `
          <tr>
            <td>${r["Date"] || ""}</td>
            <td>${r["Housekeeper"] || ""}</td>
            <td>${r["Shift"] || ""}</td>
            <td>${r["Completed Tasks"] || r["completedCount"] || ""}</td>
            <td>${r["Total Tasks"] || r["totalTasks"] || ""}</td>
            <td>${Number(r["Completion Rate"] || r["completionRate"] || 0).toFixed(2)}</td>
            <td class="small">${r["Submitted At"] || r["submittedAt"] || ""}</td>
            <td>${(r["Incomplete Tasks"] || r["incompleteList"] || "").replace(/\n/g,"<br>")}</td>
          </tr>`).join("");
      }catch(e){
        tbody.innerHTML = `<tr><td colspan="8">Error: ${e.message}</td></tr>`;
      }
    }
 <script>
(function () {
  // Your function URL (works for Netlify functions)
  const FUNCTION_URL = "/.netlify/functions/submissions";

  // Fill the Manager Dashboard table body (#mgrRows)
  async function loadManager() {
    const tbody = document.getElementById("mgrRows");
    if (!tbody) return;                        // make sure your <tbody id="mgrRows"> exists
    tbody.innerHTML = `<tr><td colspan="8">Loading…</td></tr>`;
    try {
      const res = await fetch(FUNCTION_URL);
      const payload = await res.json();
      // our Netlify function returns { submissions: [...] }
      const rows = Array.isArray(payload) ? payload : (payload.submissions || []);

      if (!rows.length) {
        tbody.innerHTML = `<tr><td colspan="8">No rows</td></tr>`;
        return;
      }

      const html = rows.map(s => `
        <tr>
          <td>${s.date || ""}</td>
          <td>${s.housekeeper || ""}</td>
          <td>${s.shift || ""}</td>
          <td>${s.completedCount ?? ""}</td>
          <td>${s.totalTasks ?? ""}</td>
          <td>${s.completionRate === "" ? "" : `${s.completionRate}%`}</td>
          <td>${(s.submittedAt || "").replace("T"," ").replace("Z","")}</td>
          <td>${
            Array.isArray(s.incompleteList)
              ? s.incompleteList.join(", ")
              : (s.incompleteList || s.incomplete || "")
          }</td>
        </tr>
      `).join("");

      tbody.innerHTML = html;
    } catch (e) {
      tbody.innerHTML = `<tr><td colspan="8">Error: ${e.message}</td></tr>`;
    }
  }

  // Load when you click the Manager Dashboard tab
  document.getElementById("tabMgr")?.addEventListener("click", loadManager);

  // Optional: also load on page open (handy for testing)
  // loadManager();

  // Expose for other code if needed:
  window.loadManager = loadManager;
})();
</script>

</body>
</html>
